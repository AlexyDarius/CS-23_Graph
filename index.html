<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS-AMC Hierarchical Network</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #network { width: 100%; height: 800px; border: 1px solid lightgray; margin-bottom: 20px; }
        #infoBox {
            padding: 10px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            display: none;
            position: absolute;
            top: 10px;
            left: 10px;
            width: 300px;
            max-width: 90%;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <h2>CS-AMC Hierarchical Network</h2>
    
    <!-- JSON File Upload Option -->
    <input type="file" id="fileInput" accept=".json">
    
    <!-- Graph Container -->
    <div id="network"></div>

    <!-- Info Box for Node Details -->
    <div id="infoBox"></div>

    <script>
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const jsonData = JSON.parse(e.target.result);
                buildGraph(jsonData);
            };
            reader.readAsText(file);
        });

        function buildGraph(jsonData) {
            let nodes = [];
            let edges = [];
            let nodeSet = new Set();
            let nodeData = {}; // Store full node info

            function addNode(id, label, title, shape, color) {
                if (!nodeSet.has(id)) {
                    nodes.push({ id, label, title, shape, color });
                    nodeData[id] = title; // Store the content for displaying on click
                    nodeSet.add(id);
                }
            }

            function addEdge(from, to) {
                edges.push({ from, to });
            }

            Object.entries(jsonData).forEach(([subpart, sections]) => {
                addNode(subpart, subpart, subpart, "box", "blue");

                sections.forEach(section => {
                    let csId = `CS-${section["CS Number"]}`;
                    addNode(csId, section["CS Number"], section["CS Name"], "ellipse", "green");
                    addEdge(subpart, csId);

                    if (section["CS Requirements"]) {
                        section["CS Requirements"].forEach(req => {
                            addNode(req["Requirement ID"], req["Requirement ID"], req["Content"], "dot", "purple");
                            addEdge(csId, req["Requirement ID"]);
                        });
                    }

                    if (section["AMCs"]) {
                        section["AMCs"].forEach(amc => {
                            let amcId = `AMC-${amc["AMC Number"]}`;
                            addNode(amcId, amc["AMC Number"], amc["AMC Name"], "diamond", "red");
                            addEdge(csId, amcId);

                            if (amc["Requirements"]) {
                                amc["Requirements"].forEach(amcReq => {
                                    addNode(amcReq["Requirement ID"], amcReq["Requirement ID"], amcReq["Content"], "triangle", "orange");
                                    addEdge(amcId, amcReq["Requirement ID"]);
                                });
                            }
                        });
                    }
                });
            });

            let container = document.getElementById("network");
            let data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };

            let options = {
                layout: {
                    hierarchical: {
                        enabled: true,
                        direction: "UD",
                        sortMethod: "directed",
                        levelSeparation: 150, // More spacing between levels
                        nodeSpacing: 200      // More spacing between nodes
                    }
                },
                physics: false,
                edges: {
                    arrows: "to",
                    smooth: false
                },
                nodes: {
                    shape: "box",
                    font: { size: 14 },
                    margin: 15
                }
            };

            let network = new vis.Network(container, data, options);

            // Show content box on node click
            network.on("click", function(params) {
                if (params.nodes.length > 0) {
                    let nodeId = params.nodes[0];
                    let content = nodeData[nodeId] || "No additional information";
                    showInfoBox(content);
                } else {
                    hideInfoBox();
                }
            });

            function showInfoBox(content) {
                let infoBox = document.getElementById("infoBox");
                infoBox.innerHTML = `<strong>Details:</strong><br>${content}`;
                infoBox.style.display = "block";
            }

            function hideInfoBox() {
                document.getElementById("infoBox").style.display = "none";
            }
        }
    </script>

</body>
</html>
